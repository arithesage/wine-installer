#!/bin/bash


function usage
{
    echo "Usage: use_wine <Wine path>"
    echo ""
    echo "Activates one Wine installation for use."
    echo ""
    echo "Basically, sets some environment variables and aliases:"
    echo "- WINE_PATH: Points to the Wine installation in use."
    echo "- WINELOADER: Points to the Wine executable."
    echo "- WINESERVER: Points to the wineserver executable."
    echo "- WINEDEBUG: Disables the 'fixme' messages."
    echo ""
    echo "- wine, winecfg, wineboot, winefile: Aliases for these commands."
    echo ""
}


if [ "$1" == "" ] || [ "$1" == "-h" ] || [ "$1" == "--help" ];
then
    usage

else
    if ! [ "$TERMUX_VERSION" == "" ];
    then
        echo "This script isn't for Termux."
        echo ""

    else
        export WINE_PATH=$1


        if ! [ -f "${WINE_PATH}/.wine_branch" ];
        then
            echo "No Wine installation found at '$WINE_PATH'."
            echo ""

        else
            WINE_BRANCH=$(cat "$WINE_PATH/.wine_branch")
            WINE_VERSION=$(cat "$WINE_PATH/.wine_version")

            WINE_BINARIES="${WINE_PATH}/opt/wine-${WINE_BRANCH}/bin"

            if [ -f "${WINE_BINARIES}/wine64" ];
            then
                export WINELOADER="${WINE_BINARIES}/wine64"
                export WINEARCH=win64
            else
                export WINELOADER="${WINE_BINARIES}/wine"
                export WINEARCH=win32
            fi

            export WINESERVER="${WINE_BINARIES}/wineserver"
            export WINEDEBUG=-all

            alias wine="${WINELOADER}"            
            alias wineboot="${WINE_BINARIES}/wineboot"
            alias winecfg="${WINE_BINARIES}/winecfg"
            #alias winefile="${WINE_PATH}/opt/wine-${WINE_BRANCH}/lib"

            echo "Using Wine (${WINEARCH}) ${WINE_BRANCH} (${WINE_VERSION}) 
                  installation at '${WINE_PATH}'."

            echo ""
        fi
    fi
fi


